## Проект Infra_sp2 (он же YaMDb):

* Проект YaMDb собирает отзывы пользователей на произведения. Сами произведения в YaMDb не хранятся, здесь нельзя посмотреть фильм или послушать музыку.
* Произведения делятся на категории, такие как «Книги», «Фильмы», «Музыка».  
* Произведению может быть присвоен жанр из списка предустановленных (например, «Сказка», «Рок» или «Артхаус»). 
* Добавлять произведения, категории и жанры может только администратор.
* Благодарные или возмущённые пользователи оставляют к произведениям текстовые отзывы и ставят произведению оценку в диапазоне от одного до десяти (целое число); из пользовательских оценок формируется усреднённая оценка произведения — рейтинг (целое число). 
* Пользователи могут оставлять комментарии к отзывам.
* Добавлять отзывы, комментарии и ставить оценки могут только аутентифицированные пользователи.

Полную документацию можно найти в "Redoc".

### Ресурсы API YaMDb
- Ресурс auth: аутентификация.
- Ресурс users: пользователи.
- Ресурс titles: произведения, к которым пишут отзывы (определённый фильм, книга или песенка).
- Ресурс categories: категории (типы) произведений («Фильмы», «Книги», «Музыка»). Одно произведение может быть привязано только к одной категории.
- Ресурс genres: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.
- Ресурс reviews: отзывы на произведения. Отзыв привязан к определённому произведению.
- Ресурс comments: комментарии к отзывам. Комментарий привязан к определённому отзыву.

### Стек технологий:
- Python 3
- DRF (Django REST framework)
- Django ORM
- Django 2.2 TLS
- Docker
- Gunicorn
- Nginx
- PostgreSQL


### Шаблон наполнения .env файла:
```
# указываем, с какой БД работаем
DB_ENGINE=
# имя базы данных
DB_NAME=
# логин для подключения к базе данных
POSTGRES_USER=
# пароль для подключения к БД (установите свой)
POSTGRES_PASSWORD=
# название сервиса (контейнера)
DB_HOST=
# порт для подключения к БД
DB_PORT=
```

### Настройка и запуск проекта:
Для развертывания ПО на боевых серверах используется среда виртуализации Docker, а также Docker-compose - инструмент для запуска многоконтейнерных приложений. 
Docker позволяет «упаковать» приложение со всем его окружением и зависимостями в контейнер, который может быть перенесён на любую Linux -систему, а также предоставляет среду по управлению контейнерами. 
Таким образом, для разворачивания серверного ПО достаточно чтобы на сервере с ОС семейства Linux были установлены среда Docker и инструмент Docker-compose.
### Все комманды для Windows.

Для запуска приложения проделайте следующие шаги:

1. Склонируйте репозиторий:
```
git clone https://github.com/Saborrr/infra_sp2.git
```
2. Перейдити в папку infra и запустите docker-compose.yaml (при установленном и запущенном Docker):
```
docker-compose up -d --build
```
3. В контейнере web выполните миграции:
```
docker-compose exec web python manage.py migrate
```
4. Создайте суперпользователя:
```
docker-compose exec web python manage.py createsuperuser
```
5. Соберите статику:
```
docker-compose exec web python manage.py collectstatic --no-input
```
Проект запущен и доступен по адресу: [localhost](http://localhost/admin/)

### Для дампа данных из БД:
```
docker-compose exec web python manage.py dumpdata > dump.json
```

### Для выгрузки данных из дампа (резервной копии) в БД:
```bash
docker-compose exec web bash
# Сброс БД, суперюзеры так же удаляются
>>> python manage.py flush
>>> python3 manage.py shell  
# выполнить в открывшемся терминале:
>>>>>> from django.contrib.contenttypes.models import ContentType
>>>>>> ContentType.objects.all().delete()
>>>>>> quit()
>>> python manage.py loaddata dump.json
```

### Описание команды для заполнения БД данными из csv:
В контейнере web выполните:
```
docker-compose exec web bash
```
```
python manage.py import_csv_files
``` 
```
exit
```

### Автор: 
- [Александр Санычев](https://github.com/Saborrr)
